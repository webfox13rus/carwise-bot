from aiogram import Router, types, F
from aiogram.filters import Command
from keyboards.main_menu import get_main_menu

router = Router()

@router.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer(
        "🚗 *Добро пожаловать в CarWise Bot!*\n\n"
        "Я помогу вам вести полный учёт расходов на автомобиль: заправки, обслуживание, страховки, а также напомню о приближающихся событиях.\n\n"
        "Используйте кнопки меню или команду /help для подробной информации.",
        parse_mode="Markdown",
        reply_markup=get_main_menu()
    )

@router.message(Command("help"))
@router.message(F.text == "📞 Помощь / О боте")  # добавляем обработчик для кнопки
async def cmd_help(message: types.Message):
    help_text = (
        "📋 *CarWise Bot – полное руководство*\n\n"
        "Бот предназначен для учёта всех расходов, связанных с автомобилем, и своевременных напоминаний.\n\n"
        
        "🚗 *Управление автомобилями*\n"
        "• `/add_car` или через меню «Мои авто» → «➕ Добавить авто»\n"
        "• `/my_cars` или «🚗 Список авто»\n"
        "• `🔄 Обновить пробег»\n"
        "• `🗑 Удалить авто»\n\n"

        "⛽ *Заправки*\n"
        "• `/fuel` или через меню «Заправки» → «⛽ Добавить заправку»\n"
        "• Быстрый ввод: `5000 45.5`\n\n"

        "🔧 *Обслуживание*\n"
        "• `/add_maintenance` или через меню «Обслуживание» → «🔧 Добавить событие»\n"
        "• Категории: ТО, мойка, ремонт, запчасти, шиномонтаж, жидкости, другое\n"
        "• Для запчастей и жидкостей можно задать интервалы замены\n\n"

        "📄 *Страховки*\n"
        "• `/insurance` или через меню «Страховки»\n"
        "• Напоминания за 7, 3 дня и в день истечения\n\n"

        "📊 *Статистика*\n"
        "• `/stats` или кнопка «📊 Статистика» – подробный отчёт по всем авто\n\n"

        "⏰ *Напоминания о ТО*\n"
        "• `/set_to_reminder` или через меню «Обслуживание» → «⏰ Напоминания ТО»\n"
        "• `/show_reminders` – текущие настройки\n\n"

        "🔧 *Плановые замены*\n"
        "• `/parts` или через меню «Обслуживание» → «🔧 Плановые замены»\n\n"

        "📤 *Экспорт данных*\n"
        "• `/export` или через меню «Ещё» → «📤 Экспорт данных»\n\n"

        "📸 *Просмотр чеков*\n"
        "• Через соответствующие подменю в «Заправки», «Обслуживание», «Страховки» или «Ещё» → «📸 Все чеки»\n\n"

        "✉️ *Связаться с админом*\n"
        "• Через меню «Ещё» → «✉️ Связаться с админом»\n\n"

        "Удачного использования!"
    )
    await message.answer(help_text, parse_mode="Markdown", reply_markup=get_main_menu())
